From 5b64e82488695aeaf316a3cfa3c967db3a994d40 Mon Sep 17 00:00:00 2001
From: Frank Wunderlich <frank-w@public-files.de>
Date: Sat, 21 May 2022 11:24:56 +0200
Subject: [PATCH 40/40] debug for barebox-iodomain/rk808 driver

---
 drivers/regulator/core.c         | 8 ++++++++
 drivers/soc/rockchip/io-domain.c | 2 +-
 2 files changed, 9 insertions(+), 1 deletion(-)

--- a/drivers/regulator/core.c
+++ b/drivers/regulator/core.c
@@ -4313,20 +4313,28 @@ int regulator_get_voltage_rdev(struct re
 
 	if (rdev->desc->ops->get_voltage_sel) {
 		sel = rdev->desc->ops->get_voltage_sel(rdev);
+		rdev_info(rdev, "%s:%d get_voltage_sel:%d\n",__FUNCTION__,__LINE__,sel);
 		if (sel < 0)
 			return sel;
 		ret = rdev->desc->ops->list_voltage(rdev, sel);
+		rdev_info(rdev, "%s:%d get_voltage_sel-list-voltage ret:%d\n",__FUNCTION__,__LINE__,ret);
 	} else if (rdev->desc->ops->get_voltage) {
 		ret = rdev->desc->ops->get_voltage(rdev);
+		rdev_info(rdev, "%s:%d get_voltage ret:%d\n",__FUNCTION__,__LINE__,ret);
 	} else if (rdev->desc->ops->list_voltage) {
 		ret = rdev->desc->ops->list_voltage(rdev, 0);
+		rdev_info(rdev, "%s:%d list_voltage ret:%d\n",__FUNCTION__,__LINE__,ret);
 	} else if (rdev->desc->fixed_uV && (rdev->desc->n_voltages == 1)) {
 		ret = rdev->desc->fixed_uV;
+		rdev_info(rdev, "%s:%d fixed_uV ret:%d\n",__FUNCTION__,__LINE__,ret);
 	} else if (rdev->supply) {
 		ret = regulator_get_voltage_rdev(rdev->supply->rdev);
+		rdev_info(rdev, "%s:%d rdev-supply ret:%d\n",__FUNCTION__,__LINE__,ret);
 	} else if (rdev->supply_name) {
+	rdev_info(rdev, "%s:%d EPROBE_DEFER\n",__FUNCTION__,__LINE__);
 		return -EPROBE_DEFER;
 	} else {
+	rdev_info(rdev, "%s:%d EINVAL\n",__FUNCTION__,__LINE__);
 		return -EINVAL;
 	}
 
--- a/drivers/soc/rockchip/io-domain.c
+++ b/drivers/soc/rockchip/io-domain.c
@@ -611,7 +611,7 @@ static int rockchip_iodomain_probe(struc
 
 		/* set initial correct value */
 		uV = regulator_get_voltage(reg);
-
+dev_err(&pdev->dev, "after get_voltage for %s: uV:%d\n",supply_name,uV);
 		/* must be a regulator we can get the voltage of */
 		if (uV < 0) {
 			dev_err(iod->dev, "Can't determine voltage: %s\n",
